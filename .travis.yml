dist: xenial
language: node_js
node_js:
  - 9
before_install:
  - | 
    if git diff --name-only $TRAVIS_COMMIT_RANGE | grep -qvE 'dartLangSpec.tex'; then
      echo "dartLangSpex.tex wasn't changed; skipping spec PDF build"
      exit 0
    else
      npm install -g firebase-tools@6.4.0
      sudo apt-get update -qq
      sudo apt-get install texlive-full
    fi
  - echo '* install completed'
script:
  - cd specification
  - make
  - mkdir public
  - cp dartLangSpec.pdf public/DartLanguageSpecificationDraft.pdf
deploy:
  - provider: script
    skip_cleanup: true
    script:
      - firebase use dart-specification --token $FIREBASE_TOKEN
      - firebase deploy --token $FIREBASE_TOKEN
    on:
      repo: dart-lang/language
      branch: testmaster
