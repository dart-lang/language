dist: xenial
language: node_js
node_js:
  - 9
before_install:
  - |
    if git diff --name-only $TRAVIS_COMMIT_RANGE | grep -qvE 'dartLangSpec.tex|.travis.yml'; then
      echo "dartLangSpex.tex wasn't changed; skipping spec PDF build"
      exit 0
    else
      npm install -g firebase-tools@6.4.0
      sudo apt-get update -qq
      sudo apt-get install \
        texlive-latex-base \
        texlive-latex-extra \
        texlive-fonts-recommended \
        latex-xcolor \
        lmodern
    fi
  - echo '* install completed'
script:
  - cd specification
  - make
deploy:
  - provider: script
    skip_cleanup: true
    script:
      - cd specification
      - echo 'Deploying from ${PWD} to https://dart-specification.firebaseapp.com/DartLangSpecDraft.pdf'
      - firebase deploy --project=dart-specification --token $FIREBASE_TOKEN
    on:
      repo: dart-lang/language
      branch: mit-mit-deployspec
